var DOM=(function(){return{Ready:function(f){if(document.readyState!='loading'){f();}else{document.addEventListener('DOMContentLoaded',f);}},Nearest:function(el,s){while(el!==undefined&&el!==null){var nearest=el.querySelectorAll(s);if(nearest.length>0){return nearest;}
el=el.parentNode;}
return[];},Attribute:function(el,a){if(el.getAttribute(a)===null){return''}
return el.getAttribute(a)},HasClass:function(el,c){var regexp=new RegExp("\\b"+c+"\\b",'gi');return regexp.test(el.className);},AddClass:function(s,c){if(typeof s==="string"){DOM.Each(s,function(el,i){if(!DOM.HasClass(el,c)){el.className=el.className+' '+c;}});}else{if(!DOM.HasClass(s,c)){s.className=s.className+' '+c;}}},RemoveClass:function(s,c){var regexp=new RegExp("\\b"+c+"\\b",'gi');if(typeof s==="string"){DOM.Each(s,function(el,i){el.className=el.className.replace(regexp,'')});}else{s.className=s.className.replace(regexp,'')}},Format:function(f){for(var i=1;i<arguments.length;i++){var regexp=new RegExp('\\{'+(i-1)+'\\}','gi');f=f.replace(regexp,arguments[i]);}
return f;},ForEach:function(a,f){Array.prototype.forEach.call(a,f);},Exists:function(s){return(document.querySelector(s)!==null);},All:function(s){return document.querySelectorAll(s);},First:function(s){return DOM.All(s)[0];},Each:function(s,f){var a=DOM.All(s);for(i=0;i<a.length;++i){f(a[i],i);}},Hidden:function(s){if(typeof s==="string"){return(DOM.First(s).style.display=='none');}else{return s.style.display=='none';}},Hide:function(s){if(typeof s==="string"){DOM.Each(s,function(el,i){el.style.display='none';});}else{s.style.display='none';}},Show:function(s){if(typeof s==="string"){DOM.Each(s,function(el,i){el.style.display='';});}else{s.style.display='';}},ShowHide:function(s){if(typeof s==="string"){DOM.Each(s,function(el,i){if(el.style.display!='none'){el.style.display='none';}else{el.style.display='';}});}else{if(s.style.display!='none'){s.style.display='none';}else{s.style.display='';}}},On:function(s,b,f){DOM.Each(s,function(el,i){el.addEventListener(b,f);});},Post:function(u,d,fs,fe){var request=new XMLHttpRequest();request.open('POST',u,true);request.onerror=fe;request.onload=function(){if(request.status>=200&&request.status<400){fs(request);}else{fe();}};request.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');request.send(d);},Get:function(u,fs,fe){var request=new XMLHttpRequest();request.open('GET',u,true);request.onload=function(){if(request.status>=200&&request.status<400){fs(request);}else{fe();}};request.onerror=fe;request.send();}};}());DOM.Ready(function(){ActivateShowlinks();ActivateMethodLinks();ActivateFilterFields();});function ActivateMethodLinks(){DOM.On('a[method="post"], a[method="delete"]','click',function(e){if(this.getAttribute('method')=='delete'){if(!confirm('Are you sure you want to delete this item, this action cannot be undone?')){return false;}}
var url=this.getAttribute('href');var redirect=this.getAttribute('data-redirect');DOM.Post(url,function(){if(redirect.length>0){window.location=redirect;}else{window.location.reload();}},function(){console.log("#error POST to"+url+"failed");});return false;});}
function ActivateFilterFields(){DOM.On('.filter-form .field select, .filter-form .field input','change',function(e){this.form.submit();});}
function ActivateShowlinks(){DOM.On('.show','click',function(e){var selector=this.getAttribute('href');DOM.Each(selector,function(el,i){if(el.className!='hidden'){el.className='hidden';}else{el.className=el.className.replace(/hidden/gi,'');}});return false;});}
DOM.Ready(function(){Editable.Activate('.content-editable-toolbar');});var Editable=(function(){return{Activate:function(s){if(!DOM.Exists(s)){return;}
DOM.Each('.content-editable-toolbar',function(toolbar){toolbar.buttons=toolbar.querySelectorAll('a');var dataEditable=toolbar.getAttribute('data-editable');toolbar.editable=DOM.First(DOM.Format("#{0}-editable",dataEditable));toolbar.textarea=DOM.First(DOM.Format("#{0}-textarea",dataEditable));if(toolbar.editable===undefined){toolbar.editable=DOM.Nearest(toolbar,'.content-editable')[0];}
if(toolbar.textarea===undefined){toolbar.textarea=DOM.Nearest(toolbar,'.content-textarea')[0];}
toolbar.textarea.style.display='none';toolbar.textarea.form.addEventListener('submit',function(e){Editable.updateContent(toolbar.editable,toolbar.textarea,false);return false;});toolbar.editable.addEventListener('input',function(e){Editable.cleanHTMLElements(this);});DOM.ForEach(toolbar.buttons,function(el,i){el.addEventListener('click',function(e){var cmd=this.id;var insert="";switch(cmd){case"showCode":Editable.updateContent(toolbar.editable,toolbar.textarea,true);break;case"createLink":insert=prompt("Supply the web URL to link to");if(insert.indexOf('http')!==0){insert="http://"+insert;}
break;case"formatblock":insert=this.getAttribute('data-format');break;default:break;}
if(cmd.length>0){document.execCommand(cmd,false,insert);}
var sel=Editable.getSelectionParentElement();if(sel!==null){Editable.cleanAlign(cmd,sel);Editable.cleanHTMLElements(sel);sel.removeAttribute('style');}
return false;});});});},cleanAlign:function(cmd,el){switch(cmd){case"justifyCenter":if(sel.hasClass('align-center')){sel.removeClass('align-center');}else{sel.addClass('align-center');}
sel.removeClass('align-left').removeClass('align-right');sel.removeAttr('style');break;case"justifyLeft":if(sel.hasClass('align-left')){sel.removeClass('align-left');}else{sel.addClass('align-left');}
sel.removeClass('align-center').removeClass('align-right');sel.removeAttribute('style');break;case"justifyRight":if(sel.hasClass('align-right')){sel.removeClass('align-right');}else{sel.addClass('align-right');}
sel.removeClass('align-center').removeClass('align-left');sel.removeAttribute('style');break;}},cleanHTML:function(html){html=html.replace(/<\/?span>/gi,'');html=html.replace(/<\/?font [^>]*>/gi,'');html=html.replace(/&nbsp;</gi,' <');html=html.replace(/<p><\/p>/gi,'\n');html=html.replace(/<br><\/li>/gi,'<\/li>');html=html.replace(/<!--[\w\d\[\]\s<\/>:.!="*{};-]*-->/gi,'');html=html.replace(/ class\=\"MsoNormal\"/gi,'');html=html.replace(/<p><o:p> <\/o:p><\/p>/gi,'');html=html.replace(/><(li|ul|ol|p|h\d|\/ul|\/ol)>/gi,'>\n<$1>');return html;},cleanHTMLElements:function(el){DOM.ForEach(el.querySelectorAll('p, div, b, i, h1, h2, h3, h4, h5, h6'),function(e){e.removeAttribute('style');});DOM.ForEach(el.querySelectorAll('span'),function(e){e.removeAttribute('style');e.removeAttribute('lang');});DOM.ForEach(el.querySelectorAll('font'),function(e){e.removeAttribute('color');});},updateContent:function(editable,textarea,toggle){var html='';if(textarea.style.display!=='none'){html=textarea.value;editable.innerHTML=html;if(toggle){editable.style.display='';textarea.style.display='none';}}else{html=editable.innerHTML;html=Editable.cleanHTML(html);textarea.value=html;if(toggle){editable.style.display='none';textarea.style.display='';}}},getSelectionParentElement:function(){var p=null,sel;if(window.getSelection){sel=window.getSelection();if(sel.rangeCount){p=sel.getRangeAt(0).commonAncestorContainer;if(p.nodeType!=1){p=p.parentNode;}}}else if((sel=document.selection)&&sel.type!="Control"){p=sel.createRange().parentElement();}
return p;}};}());